## Network 계층

### 패킷 (분할/조합)

- 전송 계층에서 만든 Segment를 패킷으로 만드는 (분할) 기능
- 데이터 링크 계층에서 만든 프레임을 패킷으로 만드는 (조합) 기능



### 혼잡제어 

- 발생 원인 : 타임아웃 시간이 적을 때, 고백 N 기법, 흐름오류, 피기배킹 사용, TTL (TimeToLive)

- 혼잡 오류 : 송신과 수신 호스트가 연결되어 있는 네트워크 망 안에서 많은 트래픽 발생하여 생기는 오류 
- 라우터의 과부화로 인한 전송 지연 제어 방식  



### 트래픽 성형

- 라우터가 혼잡오류를 처리하는 기법 

- 송신 호스트가 전송하는 패킷의 발생 빈도가 네트워크에서 예측할 수 있는 전송률로 이루어지게 하는 기능 - bps 기준을 넘으면(ECN 패킷 - 주의 표시) 전부 버리고 재전송 
- ECN이 발생한 패킷은 특별 관리를 한다.
- 리키버킷 알고리즘 : 버릴 데이터를 버퍼에 보관했다가 줄어드는 시간에 같이 재전송 



### 라우팅 

- 목적지 호스트까지 갈 수 있는 패킷 전달 경로 제공 
- 전송계층에서 정해진 TCP / UDP 에따라 연결형 (TCP)이면 가상회선, 비연결형 (UDP)이면 데이터그램 제공
- 라우팅을 하기 위한 **라우팅 테이블**이 존재
- 정적 라우팅 : 라우터가 미리 저장하여 중개 (혼잡 대처 부족 - 소규모 네트워크 적절)
- 동적 라우팅 : 라우터가 서로 정보를 수집하여 정보를 개선 (성능 저하)
- AS : Autonomous System (자율 시스템) - 단일 네트워크 
  - 내부 라우팅(IGP) : AS 안에서 동작 - 거리 벡터(RIP), 링크 상태 라우팅(OSPF)
    - 정적 라우팅
    - 동적 라우팅 : 거리 벡터(RIP, EIGRP), 링크 상태 벡터 (OSPF, IS-IS)
  - 외부 라우팅(EGP) : AS 사이에 동작 
- HELLO / ECHO 패킷
  - HELLO : 주변 경로 정보 파악하는 용도
  - ECHO : 라우터 사이의 전송 지연 시간을 측정하는 용도



### 라우팅 테이블

- 패킷 전송 과정에서 라우터들이 경로를 찾을 수 있도록 사용하는 도구
- 목적지 호스트와 홉수가 저장되어 있다. (홉수는 거리)



### 거리 벡터 - RIP

- 라우터와 연결된 이웃 네트워크에 대한 연결 정보를 보관 

- Routing By Rumer : R1은 인접한 라우터한테서만 정보를 들을 뿐, 이후 라우터 정보는 루머로만 안다.
- 30초 마다 라우터들이 정보를 주고 받는다.
- 소규모 네트워크 환경에 적합, 많이 사용하는 라우팅 프로토콜 



### 링크 상태 - OSPF

- 거리 벡터 이후에 나온 상위 프로토콜

- 모든 라우터가 LinkStateDatabase를 갖고 있는다. (각 라우터별 거리 정보)
- LSA : 업데이트 정보가 들어있는 패킷 - 새로운 정보가 생기면 LSA를 전체 라우터에 전송

- Flooding : LSA 패킷을 전부 전파하는 기법 



### IP 헤더

![image](https://user-images.githubusercontent.com/81945553/138582016-41e668f7-8d9c-4a18-b6bc-8341a13f0a5b.png)

- IP 패킷 (IP 헤더 + Payload)
- 비연결 서비스 제공 (UDP)
- ECN : 혼잡을 알려주는 용도의 패킷 
- 두 번째 줄 : 패킷 분할 과정 
  - Identification : 구분자 
  - DF : 패킷이 분할되지 않도록 지정
  - MF : 뒤에 분할된 패킷이 계속되면 1로 지정 , 마지막 패킷은 0
  - FO : 분할 전 데이터에서의 상대 주소값
- 세 번째 줄 
  - TTL (TimeToLive) : 최적의 경로의 total 거리 (거리의 모든 홉 수) 
  - Transport : UDP(17), TCP(6), ICMP(1) 주 어느 패킷인지 구별 
  - HeaderChecksum : 헤더에 대한 에러 확인 
- Source : 송신 호스트의 IP, Destination : 목적지 호스트 IP



### IP 패킷 분할 

![image](https://user-images.githubusercontent.com/81945553/138582444-8b5e8569-fbf3-4f4f-aa48-776aaae8d841.png)

- 총 전송 데이터 크기가 380바이트라면
  - 하나의 패킷은 128바이트 (20바이트 헤더, 108바이트 데이터)
  - 하지만, 8BYTE 단위로 값을 넣어야되는 것이 규칙 (20바이트 헤더 ,  104바이트 데이터, 4바이트 빈 공간)
  - 104의 FragmentOffset은 8x13인 13이 된다. 



## IP 터널

- 사용자의 데이터를 가상 서버에서 받은 후 실제 서버로 전송하는 기법 
- VPN과 같이 가상 사설망을 사용하는 것을 의미 한다.
- IP 터널링 : 무선 호스트가 움직일 때 FA(포린 에이전트)로 부터 COA(Care Of Address)를 얻는다. 
  - COA : 가상 IP
  - FA : 새로운 위치를 연결 
  - HA (홈에이전트) : 사용자가 받은 COA를 HA에서 받고 전달해준다.

